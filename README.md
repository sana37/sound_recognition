# sound_recognition

CNNを使った機械学習で音声認識できるようになりました。


## 概要

wav形式音声データをフーリエ変換して得られた周波数データをCNNに学習させます。

ここで実装したCNNは、入力がtrueかfalseか判定するだけの二値分類器です。

学習させたCNNを実際に使って音声デバイスからの音を判別させることもできます。


## 詳細

CNNの構築にはtensorflowを使っています。

また、wavファイルから読み取った音声データは、`scipy.fftpack`を使ってフーリエ変換しています。

実装内容の大まかにまとめると、次のようになります。

#### 学習

 * 指定されたパスからwavファイルを読み込む
 
 * 読み込んだwavファイルの先頭約170msを切り取り、`fftpack`でフーリエ変換する。これが教師データひとつぶんとなる
 
 * フーリエ変換後のデータは
    * 横軸：時間
    * 縦軸：周波数
    * 輝度：振幅
    
    の画像のようなデータになる
    
 * 教師データをCNNに与えて`ディープラーニング`する
 
 * CNNのモデルは、
    * 畳み込み層１
    * プーリング層１
    * 畳み込み層２
    * プーリング層２
    * 全結合層１
    * ドロップアウト層
    * 全結合層２
    
    から構成されている
 
 * 学習で得られたCNNのパラメータを保存
 
#### 音声デバイスを使った動作確認

 * 保存されているCNNのパラメータを読み込み、CNNを再構築する

 * `pyaudio`で音声デバイスを開き、音声データ取得を開始する
 
 * 取得した音声データを`fftpack`でフーリエ変換
 
 * フーリエ変換後のデータをCNNに与える。CNNの出力結果を観察できる
 

## wavファイル、音声デバイスの設定

 * rate : 48000 Hz

 * format : signed int 16 bits little endian

 * channel : monaural


## 使用したバージョン

 * `python 3.5.2`

 * `tensorflow 1.2.1`


## 使用例

指ぱっちんの音を学習させて実際に使ってみました。

https://www.youtube.com/watch?v=zfpo7Ow4mkc


## 使い方

### データセット

データセットが格納されているディレクトリを`wavdataset.py`に教えてあげます。

具体的には、`wavdataset.py`の`DatasetManager.true_dir_list`には正解データが入っているディレクトリのパスを、
`false_dir_list`には不正解データが入っているディレクトリのパスを、それぞれ追加します。

`wavdataset.py`はデータセットを管理するモジュールです。

`wavdataset.py`は、指定されたディレクトリからwav形式の音声ファイルを読み込んでフーリエ変換し、
変換後のデータを集め、これをデータセットとして、他のモジュールに提供します。



### 学習

データセットを使って学習させたいときはpythonインタプリタで`training.py`を実行します。

`training.py`は、所定のパスにあるデータセットを使ってCNNに学習させます。

学習が終わると、得られたパラメータを保存します。

学習パラメータは`sound_recognition_model.なんたら`みたいなファイルとかに保存されます。

また、`training.py`では学習後の挙動の確認用として、各入力データに対する結果をいくつか表示するようになっています。



### 音声デバイスを使った動作確認

`realtime.py`は、音声デバイスから取得した音声をCNNに与えて、実際に正しく判定できるかどうか確認するためのモジュールです。

どの音声デバイスを使用するのか指定する必要があり、`realtime.py`ではデバイス名でデバイスを見つけ、指定しています。

使用したい音声デバイスによってデバイス名は異なるので、`realtime.py`では変数`DEVICE_NAME`にて使いたいデバイスの名前を設定しています。

CNNのパラメータは、`training.py`で学習したときに保存されたものを読み込んで使っています。




## 参考

 * https://www.tensorflow.org/tutorials/layers
 * http://webdatareport.hatenablog.com/entry/2016/11/06/161304
 * http://takeshid.hatenadiary.jp/entry/2016/01/10/153503
 
